const translations = {
  es: {
    menu_planeaciones: 'Planeaciones',
    menu_reportes: 'Reportes',
    menu_configuracion: 'Configuración',
    logout: 'Cerrar sesión',
    header_historial: 'Historial de Planeaciones',
    header_reportes: 'Reportes',
    header_configuracion: 'Configuración',
    login_title: 'Iniciar sesión',
    login_ms: 'Iniciar sesión con Microsoft',
    login_user: 'Usuario:',
    login_pass: 'Contraseña:',
    login_button: 'Iniciar sesión',
    login_no_account: '¿No tienes cuenta? Regístrate aquí',
    login_ms_pending: 'Integración con Microsoft pendiente de configuración de Azure AD.',
    config_title: 'Configuración del Sistema',
    config_general: 'Información General',
    config_tech: 'Configuración Técnica',
    config_users: 'Usuarios del Sistema',
    config_institution: 'Nombre de la Institución',
    config_email: 'Email de Contacto',
    config_phone: 'Teléfono',
    config_ocr: 'Idioma OCR',
    config_ui_lang: 'Idioma de la interfaz',
    config_auto_backup: 'Respaldar automáticamente',
    config_notifications: 'Activar notificaciones',
    config_add_user: 'Agregar Usuario',
    config_save: 'Guardar Cambios',
    config_cancel: 'Cancelar',
    config_admin_only: 'Solo administradores pueden ver y gestionar usuarios.',
    user_user: 'Usuario',
    user_email: 'Email',
    user_role: 'Rol',
    user_status: 'Estado',
    user_actions: 'Acciones',
    user_activate: 'Activar',
    user_deactivate: 'Desactivar',
    user_delete: 'Eliminar',
    reportes_title: 'Planeaciones subidas',
    reportes_export: 'Exportar a Excel (XLSX)',
    reportes_select_all: 'Seleccionar todo',
    reportes_selected: 'Seleccionadas',
    reportes_history: 'Historial de reportes',
    reportes_preview: 'Vista previa',
    reportes_delete: 'Eliminar',
    reportes_empty_history: 'Aún no hay reportes generados.',
    reportes_empty: 'No hay planeaciones subidas',
    historial_new: 'Nueva Planeación',
    historial_archived: 'Archivadas',
    historial_search: 'Buscar por docente, materia, grupo o especialidad...',
    historial_empty: 'Aún no hay planeaciones registradas.',
    historial_no_match: 'No hay planeaciones que coincidan con tu búsqueda',
    historial_group_by: 'Agrupar por',
    historial_status: 'Filtrar por estado',
    historial_status_all: 'Todos',
    historial_status_completed: 'Completado',
    historial_status_draft: 'Borrador',
    historial_status_progress: 'En proceso',
    group_docente: 'Docente',
    group_carrera: 'Carrera',
    group_materia: 'Materia',
    group_grupo: 'Grupo',
    group_carrera_especialidad: 'Carrera / Especialidad',
    table_materia: 'Materia',
    table_grupo: 'Grupo',
    table_grado: 'Grado',
    table_horas: 'Horas',
    table_fechas: 'Fecha Inicio - Fin',
    table_estado: 'Estado',
    table_acciones: 'Acciones',
    action_ver: 'Ver',
    action_editar: 'Editar',
    action_renovar: 'Renovar',
    action_archivar: 'Archivar',
    action_eliminar: 'Eliminar',
    stats_total: 'Total Planeaciones',
    stats_total_archived: 'Total Archivadas',
    stats_completadas: 'Completadas',
    stats_borradores: 'Borradores',
    stats_en_proceso: 'En Proceso',
    stats_docentes: 'Docentes',
    periodo_escolar: 'Periodo Escolar',
    turno: 'Turno',
    turno_select: 'Selecciona turno',
    turno_m: 'Matutino',
    turno_v: 'Vespertino',
    fecha_elaboracion: 'Fecha de elaboración',
    modal_especialidad: 'Especialidad',
    modal_new_title: 'Nueva Planeación',
    modal_preview_title: 'Vista Previa - Edita los datos si es necesario',
    modal_carrera: 'Carrera',
    modal_grado: 'Grado',
    modal_grupo: 'Grupo',
    modal_materia: 'Nombre de Materia',
    modal_fecha_inicio: 'Fecha Inicio',
    modal_fecha_fin: 'Fecha Fin',
    modal_horas: 'Horas Totales',
    modal_docente: 'Docente',
    modal_volver: 'Volver',
    modal_guardar_borrador: 'Guardar como Borrador',
    modal_enviar: 'Enviar',
    modal_upload: 'Selecciona archivo PDF o Word de Planeación',
    modal_drag: 'Arrastra el PDF o Word aquí o haz clic',
    modal_support: 'Soporta archivos PDF y Word (.docx)',
    modal_extract: 'Extraer Datos del PDF',
    modal_extracting: 'Extrayendo datos...',
    modal_info: 'El sistema extraerá automáticamente: carrera, grado, grupo, nombre de materia, fecha, docente y horas totales.',
    modal_edit_title: 'Editar Planeación',
    modal_view_title: 'Ver Planeación',
    modal_estado: 'Estado',
    modal_cerrar: 'Cerrar',
    modal_ver_cambios: 'Ver Cambios',
    modal_guardar: 'Guardar',
    modal_archivo: 'Archivo',
    units_title: 'Unidades y Fechas',
    unit_name: 'Unidad',
    unit_date_plan: 'Fecha planeada',
    unit_date_real: 'Fecha real',
    unit_eval_plan: 'Fecha evaluación (planeada)',
    unit_eval_real: 'Fecha evaluación (real)',
    exit_title: 'Salir de la planeación',
    exit_message: '¿Quieres guardar la planeación como borrador antes de salir?',
    exit_save_draft: 'Guardar como borrador',
    exit_leave: 'Salir sin guardar',
    exit_cancel: 'Cancelar',
    unit_date_real: 'Fecha real',
    unit_eval_date: 'Fecha evaluación',
    unit_add: 'Agregar unidad',
    unit_remove: 'Quitar',
    specialty_select: 'Selecciona especialidad',
    specialty_new: 'Nueva especialidad',
    specialty_add: 'Agregar',
    specialty_delete: 'Eliminar',
    reportes_table_docente: 'Docente',
    reportes_table_materia: 'Materia',
    reportes_table_grupo: 'Grupo',
    reportes_table_grado: 'Grado',
    reportes_table_periodo: 'Periodo',
    reportes_table_archivo: 'Archivo',
    popup_ok: 'Aceptar',
    popup_confirm: 'Confirmar',
    popup_cancel: 'Cancelar'
  },
  en: {
    menu_planeaciones: 'Plans',
    menu_reportes: 'Reports',
    menu_configuracion: 'Settings',
    logout: 'Sign out',
    header_historial: 'Plans History',
    header_reportes: 'Reports',
    header_configuracion: 'Settings',
    login_title: 'Sign in',
    login_ms: 'Sign in with Microsoft',
    login_user: 'Username:',
    login_pass: 'Password:',
    login_button: 'Sign in',
    login_no_account: "Don't have an account? Register here",
    login_ms_pending: 'Microsoft integration pending Azure AD setup.',
    config_title: 'System Settings',
    config_general: 'General Information',
    config_tech: 'Technical Settings',
    config_users: 'System Users',
    config_institution: 'Institution Name',
    config_email: 'Contact Email',
    config_phone: 'Phone',
    config_ocr: 'OCR Language',
    config_ui_lang: 'UI Language',
    config_auto_backup: 'Auto backup',
    config_notifications: 'Enable notifications',
    config_add_user: 'Add User',
    config_save: 'Save Changes',
    config_cancel: 'Cancel',
    config_admin_only: 'Only admins can view and manage users.',
    user_user: 'User',
    user_email: 'Email',
    user_role: 'Role',
    user_status: 'Status',
    user_actions: 'Actions',
    user_activate: 'Activate',
    user_deactivate: 'Deactivate',
    user_delete: 'Delete',
    reportes_title: 'Uploaded plans',
    reportes_export: 'Export to Excel (XLSX)',
    reportes_select_all: 'Select all',
    reportes_selected: 'Selected',
    reportes_history: 'Reports history',
    reportes_preview: 'Preview',
    reportes_delete: 'Delete',
    reportes_empty_history: 'No reports generated yet.',
    reportes_empty: 'No uploaded plans',
    historial_new: 'New Plan',
    historial_archived: 'Archived',
    historial_search: 'Search by teacher, subject, group or specialty...',
    historial_empty: 'No plans yet.',
    historial_no_match: 'No plans match your search',
    historial_group_by: 'Group by',
    historial_status: 'Filter by status',
    historial_status_all: 'All',
    historial_status_completed: 'Completed',
    historial_status_draft: 'Draft',
    historial_status_progress: 'In progress',
    group_docente: 'Teacher',
    group_carrera: 'Program',
    group_materia: 'Subject',
    group_grupo: 'Group',
    group_carrera_especialidad: 'Program / Specialty',
    table_materia: 'Subject',
    table_grupo: 'Group',
    table_grado: 'Grade',
    table_horas: 'Hours',
    table_fechas: 'Start - End',
    table_estado: 'Status',
    table_acciones: 'Actions',
    action_ver: 'View',
    action_editar: 'Edit',
    action_renovar: 'Restore',
    action_archivar: 'Archive',
    action_eliminar: 'Delete',
    stats_total: 'Total Plans',
    stats_total_archived: 'Total Archived',
    stats_completadas: 'Completed',
    stats_borradores: 'Drafts',
    stats_en_proceso: 'In Progress',
    stats_docentes: 'Teachers',
    periodo_escolar: 'School Period',
    turno: 'Shift',
    turno_select: 'Select shift',
    turno_m: 'Morning',
    turno_v: 'Evening',
    fecha_elaboracion: 'Creation date',
    modal_especialidad: 'Specialty',
    modal_new_title: 'New Plan',
    modal_preview_title: 'Preview - Edit if needed',
    modal_carrera: 'Program',
    modal_grado: 'Grade',
    modal_grupo: 'Group',
    modal_materia: 'Subject Name',
    modal_fecha_inicio: 'Start Date',
    modal_fecha_fin: 'End Date',
    modal_horas: 'Total Hours',
    modal_docente: 'Teacher',
    modal_volver: 'Back',
    modal_guardar_borrador: 'Save as Draft',
    modal_enviar: 'Submit',
    modal_upload: 'Select PDF or Word plan file',
    modal_drag: 'Drag the PDF or Word here or click',
    modal_support: 'Supports PDF and Word (.docx)',
    modal_extract: 'Extract PDF data',
    modal_extracting: 'Extracting data...',
    modal_info: 'The system will auto-extract: program, grade, group, subject, dates, teacher and total hours.',
    modal_edit_title: 'Edit Plan',
    modal_view_title: 'View Plan',
    modal_estado: 'Status',
    modal_cerrar: 'Close',
    modal_ver_cambios: 'Review Changes',
    modal_guardar: 'Save',
    modal_archivo: 'File',
    units_title: 'Units and Dates',
    unit_name: 'Unit',
    unit_date_plan: 'Planned date',
    unit_date_real: 'Actual date',
    unit_eval_plan: 'Evaluation date (planned)',
    unit_eval_real: 'Evaluation date (actual)',
    exit_title: 'Exit plan',
    exit_message: 'Do you want to save this plan as a draft before leaving?',
    exit_save_draft: 'Save as draft',
    exit_leave: 'Leave without saving',
    exit_cancel: 'Cancel',
    unit_date_real: 'Actual date',
    unit_eval_date: 'Evaluation date',
    unit_add: 'Add unit',
    unit_remove: 'Remove',
    specialty_select: 'Select specialty',
    specialty_new: 'New specialty',
    specialty_add: 'Add',
    specialty_delete: 'Delete',
    reportes_table_docente: 'Teacher',
    reportes_table_materia: 'Subject',
    reportes_table_grupo: 'Group',
    reportes_table_grado: 'Grade',
    reportes_table_periodo: 'Period',
    reportes_table_archivo: 'File',
    popup_ok: 'OK',
    popup_confirm: 'Confirm',
    popup_cancel: 'Cancel'
  }
};

const listeners = new Set();

export const getLang = () => {
  if (typeof localStorage === 'undefined') return 'es';
  return localStorage.getItem('uiLanguage') || 'es';
};

export const setLang = (lang) => {
  if (typeof localStorage === 'undefined') return;
  localStorage.setItem('uiLanguage', lang);
};

export const notifyLangChange = () => {
  listeners.forEach(cb => cb());
};

export const subscribeLang = (cb) => {
  listeners.add(cb);
  return () => listeners.delete(cb);
};

export const t = (key) => {
  const lang = getLang();
  return translations[lang]?.[key] ?? translations.es[key] ?? key;
};
